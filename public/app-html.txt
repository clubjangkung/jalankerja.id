<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - jalankerja.id</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e6e7ee;
            color: #4a5568;
        }
        .neumorphic-btn {
            background: #e6e7ee;
            border-radius: 12px;
            box-shadow: -5px -5px 15px 0px #fff, 5px 5px 15px 0px #b8b9be;
            transition: all 0.2s ease-in-out;
        }
        .neumorphic-btn:hover {
            box-shadow: inset -5px -5px 15px 0px #fff, inset 5px 5px 15px 0px #b8b9be;
        }
         .neumorphic-btn-primary {
            background: #2563eb;
            color: white;
            box-shadow: -5px -5px 15px 0px #3b82f6, 5px 5px 15px 0px #1d4ed8;
        }
        .neumorphic-btn-primary:hover {
             background: #1d4ed8;
             box-shadow: inset -5px -5px 15px 0px #3b82f6, inset 5px 5px 15px 0px #1d4ed8;
        }
        .neumorphic-card {
            background: #e6e7ee;
            border-radius: 20px;
            box-shadow: -7px -7px 20px 0px #fff, 7px 7px 20px 0px #b8b9be;
        }
        .neumorphic-inset {
            background: #d1d9e6;
            border-radius: 12px;
            box-shadow: inset -5px -5px 15px 0px #fff, inset 5px 5px 15px 0px #b8b9be;
        }
        .neumorphic-input {
            background-color: #e6e7ee;
            border: none;
            outline: none;
            box-shadow: inset -5px -5px 15px 0px #fff, inset 5px 5px 15px 0px #b8b9be;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Loading Spinner -->
    <div id="loading-overlay" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50">
        <div class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500"></div>
    </div>

    <!-- Main Container -->
    <div id="app-container" class="w-full max-w-6xl mx-auto hidden">

        <!-- Login / Register Section -->
        <div id="auth-section" class="neumorphic-card p-8 md:p-12">
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <!-- Login Form -->
                <div id="login-form-container">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Masuk</h2>
                    <form id="login-form" class="space-y-6">
                        <input type="email" id="login-email" placeholder="Email" class="w-full p-4 rounded-lg neumorphic-input" required>
                        <input type="password" id="login-password" placeholder="Password" class="w-full p-4 rounded-lg neumorphic-input" required>
                        <button type="submit" class="w-full neumorphic-btn neumorphic-btn-primary p-4 font-bold text-lg">Masuk</button>
                    </form>
                    <p class="text-center mt-4">Belum punya akun? <a href="#" id="show-register" class="text-blue-600 font-semibold">Daftar di sini</a></p>
                </div>
                <!-- Register Form -->
                <div id="register-form-container" class="hidden">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Daftar Akun Baru</h2>
                    <form id="register-form" class="space-y-4">
                        <input type="text" id="register-name" placeholder="Nama Lengkap Siswa" class="w-full p-4 rounded-lg neumorphic-input" required>
                        <input type="email" id="register-email" placeholder="Email (Orang Tua / Siswa)" class="w-full p-4 rounded-lg neumorphic-input" required>
                        <input type="text" id="register-school" placeholder="Nama Sekolah (Opsional)" class="w-full p-4 rounded-lg neumorphic-input">
                        <input type="password" id="register-password" placeholder="Buat Password" class="w-full p-4 rounded-lg neumorphic-input" required>
                        <input type="text" id="register-affiliate-code" placeholder="Kode Promo / Affiliate (Opsional)" class="w-full p-4 rounded-lg neumorphic-input">
                        <button type="submit" class="w-full neumorphic-btn neumorphic-btn-primary p-4 font-bold text-lg">Daftar & Lanjutkan</button>
                    </form>
                    <p class="text-center mt-4">Sudah punya akun? <a href="#" id="show-login" class="text-blue-600 font-semibold">Masuk di sini</a></p>
                </div>
                 <!-- Welcome Image -->
                <div class="hidden md:block p-8">
                    <div class="neumorphic-inset p-6 rounded-2xl">
                        <img src="https://placehold.co/600x600/e6e7ee/4a5568?text=jalankerja.id" alt="Welcome" class="rounded-xl w-full">
                    </div>
                     <p class="text-center mt-6 font-semibold text-gray-600">Temukan Potensi, Rencanakan Masa Depan.</p>
                </div>
            </div>
             <p id="auth-error" class="text-red-500 text-center mt-4"></p>
        </div>

        <!-- Logged In Section -->
        <div id="logged-in-section" class="hidden">
            <header class="flex justify-between items-center mb-8">
                 <h1 class="text-3xl font-extrabold text-gray-800">jalankerja.id</h1>
                <button id="logout-btn" class="neumorphic-btn px-6 py-3 font-bold text-gray-800">Keluar</button>
            </header>

            <!-- User Dashboard -->
            <div id="user-dashboard">
                <!-- Payment Section -->
                <div id="payment-section" class="neumorphic-card p-8 md:p-12 text-center">
                    <h2 class="text-3xl font-bold text-gray-800">Satu Langkah Lagi!</h2>
                    <p class="mt-4 text-lg text-gray-600">Selesaikan pembayaran untuk membuka akses tes psikometri Anda.</p>
                    
                    <div class="my-8 neumorphic-inset p-6 max-w-md mx-auto">
                        <p class="text-lg">Harga Normal: <span class="line-through">Rp 399.000</span></p>
                        <p id="final-price-display" class="text-4xl font-extrabold text-blue-600 mt-2">Rp 247.000</p>
                        <p id="promo-info" class="text-green-600 font-semibold mt-2 h-6"></p>
                    </div>

                    <div class="max-w-xl mx-auto text-left">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Instruksi Pembayaran Manual</h3>
                        <div class="neumorphic-inset p-6 space-y-4">
                            <p>1. Lakukan transfer sebesar <strong id="transfer-amount" class="text-blue-700 font-bold">Rp 247.000</strong> ke rekening berikut:</p>
                            <div class="p-4 bg-gray-200/50 rounded-lg">
                                <p><strong>Bank Central Asia (BCA)</strong></p>
                                <p>No. Rekening: <strong>1234567890</strong></p>
                                <p>Atas Nama: <strong>PT Jalan Kerja Indonesia</strong></p>
                            </div>
                            <p>2. Unggah bukti transfer Anda di bawah ini untuk kami verifikasi. Akun Anda akan diaktifkan oleh tim kami dalam beberapa menit setelah verifikasi berhasil.</p>
                        </div>
                        
                        <div class="mt-6">
                            <label for="proof-upload" class="block font-semibold mb-2">Unggah Bukti Transfer (JPG/PNG):</label>
                            <input type="file" id="proof-upload" accept="image/jpeg, image/png" class="w-full p-3 rounded-lg neumorphic-input">
                            <button id="submit-proof-btn" class="w-full mt-4 neumorphic-btn neumorphic-btn-primary p-4 font-bold text-lg">Kirim Bukti Pembayaran</button>
                        </div>
                    </div>
                     <p id="payment-message" class="mt-4 font-semibold"></p>
                </div>

                 <!-- Waiting for Activation Section -->
                <div id="waiting-activation-section" class="neumorphic-card p-8 md:p-12 text-center hidden">
                    <h2 class="text-3xl font-bold text-gray-800">Terima Kasih!</h2>
                    <p class="mt-4 text-lg text-gray-600">Bukti pembayaran Anda telah kami terima. Tim kami sedang melakukan verifikasi.</p>
                    <p class="mt-2 text-gray-600">Akun Anda akan segera aktif. Silakan muat ulang halaman ini dalam beberapa menit.</p>
                </div>

                <!-- Test Section -->
                <div id="test-section" class="hidden">
                    <!-- Test Intro -->
                    <div id="test-intro" class="neumorphic-card p-8 md:p-12 text-center">
                        <h2 class="text-3xl font-bold text-gray-800">Selamat Datang, <span id="user-name-intro"></span>!</h2>
                        <p class="mt-4 text-lg text-gray-600">Anda siap untuk memulai perjalanan menemukan potensi diri. Tes ini terdiri dari 50 pertanyaan dan akan memakan waktu sekitar 15-20 menit.</p>
                        <p class="mt-2 text-gray-600 font-semibold">Jawablah dengan jujur sesuai dengan diri Anda, bukan siapa yang Anda inginkan.</p>
                        <button id="start-test-btn" class="mt-8 neumorphic-btn neumorphic-btn-primary p-4 px-8 font-bold text-lg">Mulai Tes</button>
                    </div>
                    <!-- Test Questions -->
                    <div id="test-questions" class="hidden">
                        <div class="neumorphic-card p-8 md:p-12">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-gray-800">Pertanyaan <span id="question-number">1</span> dari 50</h3>
                                <div class="w-1/2 bg-gray-300 rounded-full h-4 neumorphic-inset p-1">
                                    <div id="progress-bar" class="bg-blue-600 h-2 rounded-full" style="width: 2%"></div>
                                </div>
                            </div>
                            <p id="question-text" class="text-xl text-gray-700 my-8 text-center min-h-[6rem]"></p>
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                                <button data-value="-2" class="answer-btn neumorphic-btn p-4">Sangat Tidak Setuju</button>
                                <button data-value="-1" class="answer-btn neumorphic-btn p-4">Tidak Setuju</button>
                                <button data-value="0" class="answer-btn neumorphic-btn p-4">Netral</button>
                                <button data-value="1" class="answer-btn neumorphic-btn p-4">Setuju</button>
                                <button data-value="2" class="answer-btn neumorphic-btn p-4">Sangat Setuju</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Result Section -->
                <div id="result-section" class="hidden">
                    <!-- This will be populated by JS -->
                </div>

                <!-- No More Tests Section -->
                 <div id="no-more-tests-section" class="neumorphic-card p-8 md:p-12 text-center hidden">
                    <h2 class="text-3xl font-bold text-gray-800">Terima Kasih, <span id="user-name-done"></span>!</h2>
                    <p class="mt-4 text-lg text-gray-600">Anda telah menyelesaikan tes psikometri Anda.</p>
                    <p class="mt-2 text-gray-600">Anda dapat melihat kembali hasil Anda kapan saja melalui dashboard ini.</p>
                    <button id="view-result-again-btn" class="mt-8 neumorphic-btn neumorphic-btn-primary p-4 px-8 font-bold text-lg">Lihat Hasil Tes Saya</button>
                </div>
            </div>

            <!-- Affiliate Dashboard -->
            <div id="affiliate-dashboard" class="hidden space-y-8">
                 <div class="text-center">
                    <h2 class="text-3xl font-bold text-gray-800">Dashboard Affiliate</h2>
                    <p class="mt-2 text-lg text-gray-600">Selamat datang, Mitra <span id="affiliate-name"></span>!</p>
                </div>

                <!-- Affiliate Link & Code -->
                <div class="neumorphic-card p-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Alat Promosi Anda</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="font-semibold">Kode Affiliate Unik Anda:</label>
                            <div class="flex mt-2">
                                <input id="affiliate-code-text" type="text" class="w-full p-3 rounded-l-lg neumorphic-input" readonly>
                                <button id="copy-code-btn" class="neumorphic-btn rounded-l-none px-4 font-semibold">Salin</button>
                            </div>
                        </div>
                         <div>
                            <label class="font-semibold">Link Affiliate Unik Anda:</label>
                            <div class="flex mt-2">
                                <input id="affiliate-link-text" type="text" class="w-full p-3 rounded-l-lg neumorphic-input" readonly>
                                <button id="copy-link-btn" class="neumorphic-btn rounded-l-none px-4 font-semibold">Salin</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="neumorphic-card p-6 text-center">
                        <p class="text-lg font-semibold">Total Klik</p>
                        <p id="stats-clicks" class="text-4xl font-extrabold text-blue-600 mt-2">0</p>
                    </div>
                    <div class="neumorphic-card p-6 text-center">
                        <p class="text-lg font-semibold">Pendaftar</p>
                        <p id="stats-signups" class="text-4xl font-extrabold text-blue-600 mt-2">0</p>
                    </div>
                    <div class="neumorphic-card p-6 text-center">
                        <p class="text-lg font-semibold">Penjualan Bulan Ini</p>
                        <p id="stats-sales" class="text-4xl font-extrabold text-blue-600 mt-2">0</p>
                    </div>
                </div>

                <!-- Earnings & Bonus -->
                <div class="neumorphic-card p-8">
                     <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">Penghasilan & Bonus Bulan Ini</h3>
                     <div class="grid md:grid-cols-2 gap-8 items-center">
                        <div class="text-center">
                            <p class="text-lg font-semibold">Total Komisi Dasar</p>
                             <p id="stats-commission" class="text-5xl font-extrabold text-green-600 mt-2">Rp 0</p>
                             <p class="text-sm text-gray-500">(Rp 60.000 per penjualan)</p>
                        </div>
                        <div class="text-center">
                            <p class="text-lg font-semibold">Total "Kolam Bonus"</p>
                             <p id="stats-bonus-pool" class="text-5xl font-extrabold text-yellow-500 mt-2">Rp 0</p>
                             <p class="text-sm text-gray-500">(Bonus akan dibagikan sesuai pencapaian di akhir bulan)</p>
                        </div>
                     </div>
                </div>
            </div>

            <!-- Admin Dashboard -->
            <div id="admin-dashboard" class="hidden space-y-8">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-gray-800">Dashboard Admin</h2>
                    <p class="mt-2 text-lg text-gray-600">Selamat datang, Admin!</p>
                </div>

                <!-- Admin Tabs -->
                <div class="flex justify-center border-b-2 border-gray-300">
                    <button data-tab="activation" class="admin-tab p-4 font-semibold border-b-4 border-blue-600">Aktivasi Manual</button>
                    <button data-tab="discounts" class="admin-tab p-4 font-semibold border-transparent">Kelola Diskon</button>
                    <button data-tab="reports" class="admin-tab p-4 font-semibold border-transparent">Laporan Kolektif</button>
                </div>
                
                <!-- Activation Panel -->
                <div id="activation-panel" class="admin-panel neumorphic-card p-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Permintaan Aktivasi Tertunda</h3>
                    <div id="activation-requests-list" class="space-y-4">
                        <!-- Requests will be populated here -->
                         <p>Tidak ada permintaan aktivasi saat ini.</p>
                    </div>
                </div>

                <!-- Discount Management Panel -->
                <div id="discounts-panel" class="admin-panel neumorphic-card p-8 hidden">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Kelola Kode Diskon B2B</h3>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-xl font-bold mb-4">Buat Kode Baru</h4>
                            <form id="create-discount-form" class="space-y-4 neumorphic-inset p-6">
                                <input id="discount-code" type="text" placeholder="Kode Unik (e.g., SMAN1MAJU)" class="w-full p-3 rounded-lg neumorphic-input uppercase" required>
                                <input id="discount-description" type="text" placeholder="Deskripsi (e.g., SMAN 1 Jakarta)" class="w-full p-3 rounded-lg neumorphic-input" required>
                                <select id="discount-type" class="w-full p-3 rounded-lg neumorphic-input">
                                    <option value="percentage">Persentase (%)</option>
                                    <option value="fixed">Nominal Tetap (Rp)</option>
                                </select>
                                <input id="discount-value" type="number" placeholder="Nilai (e.g., 20 untuk 20%)" class="w-full p-3 rounded-lg neumorphic-input" required>
                                <input id="discount-max-uses" type="number" placeholder="Maksimal Penggunaan" class="w-full p-3 rounded-lg neumorphic-input" required>
                                <button type="submit" class="w-full neumorphic-btn neumorphic-btn-primary p-3 font-bold">Buat Kode</button>
                            </form>
                            <p id="discount-message" class="mt-4 font-semibold"></p>
                        </div>
                        <div>
                             <h4 class="text-xl font-bold mb-4">Daftar Kode Aktif</h4>
                             <div id="discount-codes-list" class="space-y-3 max-h-96 overflow-y-auto p-2">
                                 <!-- Codes will be populated here -->
                                 <p>Belum ada kode diskon yang dibuat.</p>
                             </div>
                        </div>
                    </div>
                </div>

                <!-- Collective Reports Panel -->
                <div id="reports-panel" class="admin-panel neumorphic-card p-8 hidden">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Laporan Kolektif</h3>
                    <div class="flex space-x-4 mb-6">
                        <input id="filter-input" type="text" placeholder="Filter berdasarkan Nama Sekolah atau Kode Promo" class="w-full p-3 rounded-lg neumorphic-input">
                        <button id="filter-btn" class="neumorphic-btn px-6 font-semibold">Filter</button>
                        <button id="download-pdf-btn" class="neumorphic-btn px-6 font-semibold bg-green-500 text-white">Download PDF</button>
                    </div>
                    <div id="report-table-container" class="overflow-x-auto">
                        <table class="min-w-full bg-white/30 rounded-lg">
                            <thead class="bg-gray-200/50">
                                <tr>
                                    <th class="p-3 text-left">Nama Siswa</th>
                                    <th class="p-3 text-left">Email</th>
                                    <th class="p-3 text-left">Sekolah</th>
                                    <th class="p-3 text-left">Kode Bakat</th>
                                    <th class="p-3 text-left">Laporan Lengkap</th>
                                </tr>
                            </thead>
                            <tbody id="report-table-body">
                                <!-- Report data will be populated here -->
                                <tr><td colspan="5" class="p-4 text-center">Silakan filter untuk menampilkan data.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>
    
    <script>
        // Your Firebase configuration object
        const firebaseConfig = {
            // PASTE KONFIGURASI FIREBASE ANDA DI SINI
            apiKey: "...",
            authDomain: "...",
            projectId: "...",
            storageBucket: "...",
            messagingSenderId: "...",
            appId: "..."
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const functions = firebase.functions();

        // All application logic will go here
    </script>
</body>
</html>
